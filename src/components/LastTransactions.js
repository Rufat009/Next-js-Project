"use client";

import React, { useEffect, useState, useMemo } from "react";
import Card from "./Card";
import { StyledTitle } from "./StyledComponents";

const LastTransactions = () => {
    const [transactions, setTransactions] = useState([]);

    useEffect(() => {
        const fetchTransactions = async () => {
            try {
                const response = await fetch("/api/last-transactions");
                const data = await response.json();
                setTransactions(data.lastTransactions);
            } catch (error) {
                console.error("Failed to fetch transactions:", error);
            }
        };

        fetchTransactions();
    }, []);

    const transactionRows = useMemo(() => {
        return transactions.map((transaction, index) => (
            <div key={index} className="grid grid-cols-5 items-center gap-2.5 pb-2.5">
                <div className="flex items-center gap-3.5">
                    <div
                        className={`w-[55px] h-[55px] rounded-[20px] flex items-center justify-center ${
                            transaction.type === "Shopping"
                                ? "bg-[#E7EDFF]"
                                : transaction.type === "Service"
                                ? "bg-[#E7EDFF]"
                                : transaction.type === "Transfer"
                                ? "bg-[#FFE0EB]"
                                : "bg-[#E7EDFF]"
                        }`}
                    >
                        <Icon index={index} />
                    </div>
                    <div className="flex flex-col">
                        <div className="font-medium text-[#232323] text-[16px] font-inter">
                            {transaction.name}
                        </div>
                        <div className="text-[15px] text-[#718ebf] font-normal font-inter">
                            {transaction.date}
                        </div>
                    </div>
                </div>
                <div className="text-[16px] text-[#718ebf] font-normal font-inter">
                    {transaction.type}
                </div>
                <div className="text-[16px] text-[#718ebf] font-normal font-inter">
                    {transaction.accountNumber}
                </div>
                <div className="text-[16px] text-[#718ebf] font-normal font-inter">
                    {transaction.status}
                </div>
                <div
                    className={`font-medium text-[16px] font-inter text-right ${
                        transaction.amount > 0 ? "text-[#16DBAA]" : "text-[#FE5C73]"
                    }`}
                >
                    {transaction.amount > 0 ? "+" : "-"}${Math.abs(transaction.amount).toLocaleString()}
                </div>
            </div>
        ));
    }, [transactions]);

    if (transactions.length === 0) {
        return (
            <Card width="730px" height="235px" padding={"25px"}>
                <StyledTitle>Loading...</StyledTitle>
            </Card>
        );
    }

    return (
        <Card width="730px" height="235px" padding={"25px"}>
            {transactionRows}
        </Card>
    );
};

const Icon = ({ index }) => {
    switch (index) {
        case 0:
            return (
                <svg
                    width="27"
                    height="27"
                    viewBox="0 0 27 27"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <g clipPath="url(#clip0_101_186)">
                        <path
                            d="M25.3716 14.0972C24.938 14.0453 24.5444 14.3551 24.4925 14.7889C23.8424 20.2357 19.2035 24.3434 13.7021 24.3434C8.75397 24.3434 4.50459 21.0205 3.22642 16.3894L4.17274 16.9092C4.55568 17.1195 5.03666 16.9794 5.24677 16.5967C5.45709 16.2137 5.31722 15.7328 4.93429 15.5224L2.50689 14.1893C2.12437 13.9792 1.64379 14.1186 1.43327 14.5009L0.0982465 16.9252C-0.112482 17.308 0.0269738 17.7889 0.409498 17.9997C0.804588 18.1845 1.25612 18.0936 1.48394 17.6884L1.79334 17.1267C3.36072 22.2682 8.14712 25.9254 13.7021 25.9254C20.0041 25.9254 25.3183 21.2183 26.0631 14.9764C26.1151 14.5425 25.8052 14.1489 25.3716 14.0972Z"
                            fill="#16DBCC"
                        />
                        <path
                            d="M26.5214 7.80969C26.1206 7.63686 25.655 7.82164 25.482 8.22291L25.2327 8.8005C24.4539 6.89612 23.2039 5.19196 21.5939 3.87259C19.3772 2.05555 16.5745 1.05505 13.702 1.05505C10.8295 1.05505 8.02676 2.05555 5.80989 3.87259C3.62371 5.6643 2.10021 8.16502 1.52014 10.9138C1.42991 11.3412 1.70347 11.7608 2.1309 11.851C2.55771 11.9412 2.97793 11.6679 3.06795 11.2405C3.57407 8.84252 4.90394 6.66047 6.81265 5.09597C8.74731 3.51025 11.1941 2.63706 13.702 2.63706C16.2097 2.63706 18.6565 3.51025 20.5912 5.09597C22.0782 6.31461 23.2136 7.90836 23.8823 9.68688L22.8807 9.25615C22.4795 9.08374 22.0141 9.26892 21.8415 9.67019C21.6689 10.0715 21.8543 10.5366 22.2556 10.7092L24.7999 11.8036C25.2329 11.9826 25.6546 11.7997 25.839 11.3902L26.9346 8.84912C27.1077 8.44805 26.9227 7.98272 26.5214 7.80969Z"
                            fill="#16DBCC"
                        />
                        <path
                            d="M18.5773 7.67111C18.8043 7.2132 18.8391 6.6941 18.6757 6.20982C18.5124 5.72553 18.1702 5.33394 17.7123 5.10694C16.7668 4.63852 15.6168 5.02661 15.1482 5.9719C15.0458 6.17871 14.9827 6.39789 14.9593 6.62077C14.3483 6.56453 13.7272 6.62139 13.1253 6.79462C11.9273 7.13904 10.9083 7.91398 10.2561 8.97627L8.12018 12.455C7.83488 12.404 7.5399 12.4252 7.25769 12.5203C6.81626 12.6693 6.45927 12.9811 6.25267 13.3983L6.11177 13.6823C5.68496 14.5438 6.03844 15.5921 6.90009 16.0189L11.5238 18.3099C11.0685 19.257 11.2724 20.3214 12.454 20.9159C13.4899 21.3415 14.6431 20.9245 15.0909 20.0775L15.5797 20.3195C15.824 20.4407 16.0873 20.5018 16.3522 20.5018C16.5398 20.5018 16.7283 20.4712 16.9112 20.4094C17.3525 20.2606 17.7094 19.9488 17.9163 19.5314L18.0569 19.2474C18.2638 18.83 18.2957 18.3573 18.1468 17.9158C18.0516 17.6336 17.8897 17.386 17.6763 17.1899L19.1503 13.3834C19.6004 12.2208 19.5996 10.9406 19.1481 9.77881C18.9213 9.19503 18.5903 8.66646 18.1756 8.21431C18.3385 8.06064 18.4749 7.87793 18.5773 7.67111ZM16.8614 6.48708C17.0449 6.48708 17.1936 6.6358 17.1936 6.81914C17.1936 7.00267 17.0449 7.15119 16.8614 7.15119C16.678 7.15119 16.5293 7.00247 16.5293 6.81914C16.5293 6.6358 16.678 6.48708 16.8614 6.48708ZM13.4697 19.5195C13.3659 19.5547 13.2547 19.5471 13.1564 19.4985C13.0582 19.4499 12.9848 19.3658 12.9498 19.262C12.9224 19.1808 12.9214 19.0949 12.9455 19.0146L13.6694 19.3732C13.6197 19.441 13.5509 19.4923 13.4697 19.5195ZM17.675 12.8122L16.0693 16.9584C15.8434 17.4707 16.0595 18.0771 16.566 18.3284H16.5662C16.6488 18.3725 16.6791 18.4632 16.6395 18.5451L16.4986 18.8292C16.4515 18.9116 16.3674 18.9386 16.2821 18.9021L7.60252 14.6015C7.5226 14.5619 7.48964 14.4647 7.52919 14.385L7.67009 14.1009C7.70819 14.0307 7.78215 13.9808 7.88679 14.0278C8.13913 14.1528 8.42504 14.172 8.692 14.0822C8.94393 13.9971 9.15054 13.8243 9.27805 13.5929L11.6041 9.80414C12.0492 9.07906 12.7449 8.55007 13.5626 8.31483C14.3802 8.07959 15.2505 8.15807 16.0127 8.53586C16.0129 8.53586 16.0129 8.53586 16.0131 8.53607C16.0133 8.53607 16.0133 8.53607 16.0135 8.53627C16.7759 8.91406 17.3654 9.55881 17.6736 10.3519C17.9818 11.1449 17.9822 12.0187 17.675 12.8122Z"
                            fill="#16DBCC"
                        />
                    </g>
                    <defs>
                        <clipPath id="clip0_101_186">
                            <rect width="27" height="27" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            );
        case 1:
            return (
                <svg
                    width="25"
                    height="25"
                    viewBox="0 0 25 25"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                     <g clipPath="url(#clip0_101_199)">
                        <path
                            d="M4.20898 21.5226C4.61349 21.5226 4.94141 21.1947 4.94141 20.7902C4.94141 20.3857 4.61349 20.0577 4.20898 20.0577C3.80448 20.0577 3.47656 20.3857 3.47656 20.7902C3.47656 21.1947 3.80448 21.5226 4.20898 21.5226Z"
                            fill="#396AFF"
                        />
                        <path
                            d="M19.8337 12.0366C21.1271 11.8463 22.3007 11.2558 23.2275 10.329C24.1099 9.44667 24.6907 8.3328 24.907 7.10785C25.1183 5.91136 24.9697 4.69442 24.4773 3.58856C24.2684 3.11951 23.653 3.00574 23.2903 3.36859L20.2899 6.36888C20.166 6.49271 19.9646 6.49271 19.8407 6.36888L18.6309 5.15916C18.5073 5.03553 18.5073 4.83436 18.6309 4.71073L21.6317 1.71004C21.9948 1.34695 21.8804 0.731817 21.4117 0.523126C20.3058 0.0306451 19.0888 -0.117988 17.8923 0.0933405C16.6673 0.309649 15.5534 0.890411 14.671 1.77278C13.7442 2.69959 13.1536 3.87313 12.9634 5.16649C12.8063 6.23387 12.9316 7.30179 13.3255 8.28841L11.1284 10.0932L6.222 5.18695L7.08519 4.32381C7.39451 4.01453 7.36531 3.50369 7.02205 3.23182L3.70115 0.601544C3.4097 0.370733 2.99144 0.394854 2.7285 0.657794L0.656915 2.72928C0.393976 2.99217 0.369757 3.41038 0.600665 3.70189L3.23104 7.02264C3.50291 7.36585 4.01341 7.39544 4.32308 7.08578L5.18621 6.22264L9.99109 11.0273L0.972003 18.4358C-0.228729 19.3855 -0.332343 21.1723 0.749933 22.2545L2.74505 24.2496C3.82718 25.3316 5.6139 25.2284 6.5639 24.0275L13.9726 15.0087L14.7169 15.753L13.6464 16.8234C13.3712 17.0985 13.3593 17.5407 13.619 17.8303L19.2003 24.0527C20.298 25.2709 22.1915 25.3216 23.3522 24.1609L24.1607 23.3523C25.3239 22.1893 25.2687 20.2821 24.0394 19.1883C24.0388 19.1879 24.0384 19.1874 24.0379 19.187L17.7868 13.6558C17.4969 13.3993 17.0574 13.4126 16.7835 13.6864L15.7526 14.7172L14.9068 13.8715L16.7117 11.6745C17.6983 12.0683 18.7662 12.1936 19.8337 12.0366ZM3.86873 5.46859L2.15394 3.30374L3.30296 2.15477L5.4679 3.86947L3.86873 5.46859ZM17.3321 15.2093L23.0662 20.2831C23.3566 20.5416 23.5228 20.898 23.5342 21.2867C23.5455 21.6757 23.4002 22.0414 23.125 22.3166L22.3165 23.1251C22.0425 23.3991 21.6784 23.5447 21.2914 23.5343C20.9042 23.5242 20.5481 23.3602 20.2898 23.0734L15.1727 17.3686L17.3321 15.2093ZM15.9372 10.3096L13.3518 13.4568C13.3514 13.4572 13.3511 13.4577 13.3508 13.458L5.42737 23.1034C5.42401 23.1075 5.42064 23.1117 5.41732 23.1159C5.01131 23.6329 4.24676 23.6797 3.78084 23.2138L1.78572 21.2187C1.32088 20.754 1.36551 19.9893 1.88372 19.5824C1.88792 19.5791 1.89207 19.5757 1.89622 19.5723L11.542 11.6491C11.5423 11.6488 11.5425 11.6486 11.5428 11.6484L14.6904 9.06288C14.9576 8.84339 15.0348 8.46688 14.8757 8.1599C13.9526 6.37923 14.2866 4.22869 15.7068 2.80853C16.5814 1.93397 17.7654 1.46922 18.9627 1.46922C19.2207 1.46922 19.4793 1.4908 19.7356 1.5345L17.5951 3.67493C16.9004 4.36966 16.9004 5.50008 17.5951 6.19486L18.8049 7.40457C19.4998 8.0995 20.6307 8.0996 21.3257 7.40457L23.4658 5.26458C23.7123 6.70999 23.2547 8.23026 22.1917 9.29325C20.7715 10.7134 18.6209 11.0473 16.8402 10.1243C16.5332 9.96512 16.1567 10.0424 15.9372 10.3096Z"
                            fill="#396AFF"
                        />
                    </g>
                    <defs>
                        <clipPath id="clip0_101_199">
                            <rect width="25" height="25" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            );
        case 2:
            return (
                <svg
                    width="25"
                    height="25"
                    viewBox="0 0 25 25"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                   <g clipPath="url(#clip0_101_213)">
                        <path
                            d="M21.3389 16.1611C19.9774 14.7997 18.3569 13.7918 16.5888 13.1817C18.4825 11.8775 19.7266 9.69473 19.7266 7.22656C19.7266 3.24185 16.4847 0 12.5 0C8.51528 0 5.27344 3.24185 5.27344 7.22656C5.27344 9.69473 6.51753 11.8775 8.41123 13.1817C6.64316 13.7918 5.02266 14.7997 3.66118 16.1611C1.30024 18.5221 0 21.6611 0 25H1.95312C1.95312 19.1844 6.68442 14.4531 12.5 14.4531C18.3156 14.4531 23.0469 19.1844 23.0469 25H25C25 21.6611 23.6998 18.5221 21.3389 16.1611ZM12.5 12.5C9.59224 12.5 7.22656 10.1344 7.22656 7.22656C7.22656 4.31875 9.59224 1.95312 12.5 1.95312C15.4078 1.95312 17.7734 4.31875 17.7734 7.22656C17.7734 10.1344 15.4078 12.5 12.5 12.5Z"
                            fill="#FF82AC"
                        />
                    </g>
                    <defs>
                        <clipPath id="clip0_101_213">
                            <rect width="25" height="25" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            );
        default:
            return null;
    }
};

export default LastTransactions;